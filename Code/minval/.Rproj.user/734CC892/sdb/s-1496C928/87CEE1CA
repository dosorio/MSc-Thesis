{
    "collab_server" : "",
    "contents" : "setwd(\"~/Dropbox/Maestría Bioinformática/Tesis de Maestría/\")\nsource(\"https://bioconductor.org/biocLite.R\")\n#biocLite(\"DESeq\")\n#biocLite(\"ReactomePA\")\n#biocLite(\"KEGGREST\")\n#biocLite(\"reactome.db\")\n#biocLite(\"UniProt.ws\")\n#biocLite(\"org.Hs.eg.db\")\n# require(DESeq)\n# require(edgeR)\nrequire(caret)\n# require(KEGGREST)\nrequire(reactome.db)\nrequire(UniProt.ws)\nrequire(ReactomePA)\n\n# Lectura FPKM astrocitos 21 - 63 yo\nAstrocyte <-read.csv(\"Data/GSE73721.csv\",row.names = \"Gene\")[,c(18:26)]\n\n# Eliminando genes que no varian expresión en ningun tiempo (ruido basal)\nActiveGenes<-Astrocyte[-nearZeroVar(t(Astrocyte)),]\n\n# Basandome en el FPKM (anotando nuevamente), busco cuales son diferencialmente expresados (mayor expresión en >40) usando prueba t\nDE<-NULL\nfor(i in 1:dim(ActiveGenes)[1]){\n  DE[i]<-try(t.test(t(ActiveGenes)[,i]~c(rep('A',3),rep('B',6)), alternative=\"less\")$p.value,silent = TRUE)\n}\n\n# Identifico genes diferencialmente expresados usando p<0.5\nDE<-as.numeric(DE)<0.05\ntable(DE)\n\n# Extraigo ID's genes en diferentes bases de datos\nHuman<-(UniProt.ws(taxId=9606))\nHSA<-select(Human,keys=toupper(unique(rownames(ActiveGenes))),columns = c(\"ENSEMBL\",\"ENTREZ_GENE\",\"ENTRY-NAME\",\"KO\",\"KEGG\",\"EC\",\"REACTOME\",\"PROTEIN-NAMES\"),keytype =\"GENECARDS\")\nMatureAstrocyte<- select(Human,keys=toupper(unique(rownames(ActiveGenes[DE,]))),columns = c(\"ENSEMBL\",\"ENTREZ_GENE\",\"ENTRY-NAME\",\"KO\",\"KEGG\",\"EC\",\"REACTOME\",\"PROTEIN-NAMES\"),keytype =\"GENECARDS\")\n\n# Excluyo proteínas con actividad enzimática\nEC<-HSA[!is.na(HSA$ENSEMBL),]\n\n# Extraigo rutas metabolicas involucradas en la diferenciación de astrocito maduro\nAstrocyteMetabolism<-enrichPathway(unique(na.omit(HSA$ENTREZ_GENE)),organism = \"human\",readable = TRUE,pvalueCutoff = 0.05)\nResumenAstrocyte<-summary(AstrocyteMetabolism)\n\n# Extrayendo ENSEMBL ID's\nENSEMBL<-unique(unlist(strsplit(EC$ENSEMBL,\";\")))\n\n# Extrayendo de HMR\nHMR<-read.csv(\"Data/rxn_HMRdatabase2_00.csv\",sep = \";\")\nRXN<-NULL\nfor (i in 1:length(ENSEMBL)){\n  RXN<-c(RXN,as.vector(HMR[grep(ENSEMBL[i],HMR$GENE.ASSOCIATION),2]))\n}\n\n# Reconstrucción Borrador\nAstrocyte_DRAFT<-unique(HMR[HMR$RXNID%in%sort(RXN),])\nAstrocyte_DRAFT<-Astrocyte_DRAFT[!grepl(\"[[:digit:]]\\\\.[[:digit:]]\",Astrocyte_DRAFT$EQUATION),]\n# Convirtiendo a Sybil\n\ncobra2sybil<-function(reaction){\n  coeficients <- function(met) {\n    regmatches(met, gregexpr('^[0-9]+[[:blank:]]', met))\n  }\n  \n  if(grepl(\"[[:blank:]]=>[[:blank:]]\",reaction)){\n    reactant <- sub(\"(.*) => (.*)\",\"\\\\1\",reaction)\n    products <- sub(\"(.*) => (.*)\",\"\\\\2\",reaction)\n    reactant <- strsplit(reactant,\" + \",fixed = TRUE)[[1]]\n    products <- strsplit(products,\" + \",fixed = TRUE)[[1]]\n    reactant <- gsub(\"\\\\+\",\"\",reactant)\n    products <- gsub(\"\\\\+\",\"\",products)\n    r_coefic <- as.numeric(sapply(reactant, coeficients))\n    r_coefic[is.na(r_coefic)]<-1\n    p_coefic <- as.numeric(sapply(products, coeficients))\n    p_coefic[is.na(p_coefic)]<-1\n    reactant <- gsub(\"^[[:digit:]]+[[:blank:]]\",\"\",reactant)\n    products <- gsub(\"^[[:digit:]]+[[:blank:]]\",\"\",products)\n    reactant <- mapply(function(c,m){paste(\"(\",c,\") \", m, sep = \"\")}, c=r_coefic, m=reactant)\n    products <- mapply(function(c,m){paste(\"(\",c,\") \", m, sep = \"\")}, c=p_coefic, m=products)\n    reaction <- paste(paste0(reactant,collapse = \" + \"), paste0(products,collapse = \" + \"),sep = \" --> \")\n  }else{\n    reactant <- sub(\"(.*) <=> (.*)\",\"\\\\1\",reaction)\n    products <- sub(\"(.*) <=> (.*)\",\"\\\\2\",reaction)\n    reactant <- strsplit(reactant,\" + \",fixed = TRUE)[[1]]\n    products <- strsplit(products,\" + \",fixed = TRUE)[[1]]\n    reactant <- gsub(\"\\\\+\",\"\",reactant)\n    products <- gsub(\"\\\\+\",\"\",products)\n    r_coefic <- as.numeric(sapply(reactant, coeficients))\n    r_coefic[is.na(r_coefic)]<-1\n    p_coefic <- as.numeric(sapply(products, coeficients))\n    p_coefic[is.na(p_coefic)]<-1\n    reactant <- gsub(\"^[[:digit:]]+[[:blank:]]\",\"\",reactant)\n    products <- gsub(\"^[[:digit:]]+[[:blank:]]\",\"\",products)\n    reactant <- mapply(function(c,m){paste(\"(\",c,\") \", m, sep = \"\")}, c=r_coefic, m=reactant)\n    products <- mapply(function(c,m){paste(\"(\",c,\") \", m, sep = \"\")}, c=p_coefic, m=products)\n    reaction <- paste(paste0(reactant,collapse = \" + \"), paste0(products,collapse = \" + \"),sep = \" <==> \")\n  }\n  gsub(\"\\\\[s\\\\]\",\"\\\\[e\\\\]\",reaction)\n}\n\nreversible <- function(reaction){\n  if(grepl(\"[[:blank:]]-->[[:blank:]]\",reaction)){\n    return(\"irreversible\")\n  } else {\n    return(\"reversible\")\n  }\n}\n\ncompartment <- function(reaction){\n  reaction <- strsplit(reaction,\" <==> \",fixed = TRUE)[[1]]\n  reaction <- strsplit(reaction,\" --> \",fixed = TRUE)[[1]]\n  reaction <- unlist(strsplit(reaction,\" + \",fixed = TRUE))\n  comp<-unlist(regmatches(reaction, gregexpr('\\\\[[[:alpha:]]\\\\]$', reaction)))\n  comp<-gsub(\"\\\\[\",\"\",comp)\n  comp<-gsub(\"\\\\]\",\"\",comp)\n  paste(unique(comp),collapse = \", \")\n}\n\nmetabolites<-function(reaction){\n  reaction <- strsplit(reaction,\" <==> \",fixed = TRUE)[[1]]\n  reaction <- strsplit(reaction,\" --> \",fixed = TRUE)[[1]]\n  reaction <- unlist(strsplit(reaction,\" + \",fixed = TRUE))\n  mets<-gsub(\"\\\\([[:digit:]]+\\\\)[[:blank:]]\",\"\",mets)\n}\n\nmetmodel<-function(m_name){\n  if (grepl(\"\\\\[\",m_name) || grepl(\"\\\\(\",m_name)){\n    c<-gsub(m_name,\"\",metabolites[grep(m_name,metabolites,fixed = TRUE)],fixed = TRUE)\n    unique(gsub(\"\\\\]\",\"\",gsub(\"\\\\[\",\"\",c)))\n  } else {\n    unique(gsub(\"\\\\]\",\"\",gsub(paste0(m_name,\"\\\\[\"),\"\",metabolites[grep(paste0(\"^\",m_name,\"\\\\[\"),metabolites)])))\n  }\n}\n\nreactions<-sapply(Astrocyte_DRAFT$EQUATION,cobra2sybil)\nnames <- Astrocyte_DRAFT$RXNID\nrever <- as.vector(sapply(reactions,reversible))\ncomp<- as.vector(sapply(reactions,compartment))\nAstrocyte_MODEL<-as.data.frame(cbind(as.character(names),as.character(names),as.character(reactions),as.character(rever),as.character(comp),-1000,1000,0,\"\",\"\"))\ncolnames(Astrocyte_MODEL)<-c(\"abbreviation\",\"name\",\"equation\",\"reversible\",\"compartment\",\"lowbnd\",\"uppbnd\",\"obj_coef\",\"rule\",\"subsystem\")\nwrite.table(Astrocyte_MODEL,sep = \"\\t\",row.names = FALSE,file = \"Astrocyte_react.tsv\")\n\n\nmetabolites <- unique(unlist(sapply(as.vector(Astrocyte_MODEL$equation),metabolites)))\nm_names <- unique(gsub('\\\\[[[:alpha:]]\\\\]',\"\",metabolites))\n",
    "created" : 1456320503848.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3054396460",
    "id" : "87CEE1CA",
    "lastKnownWriteTime" : 1456330726,
    "last_content_update" : 1456330726533,
    "path" : "~/Dropbox/Maestría Bioinformática/Tesis de Maestría/Code/Astrocytes_47-63.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}